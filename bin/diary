#!/usr/bin/env bash
# diary by Amory Meltzer
# Simple script to handle a simple diary

today=$(date +"%Y-%m-%d").md

function newDay {
    if [[ ! -f $today ]]; then
	title=$(date +"%A, %B %d, %Y")
	printf "## $title\n\n" > $today
	notes=$(cat notes)
	if [[ -n $notes ]]; then
	    printf "### Thoughts ###\n" >> $today
	    echo "$notes" >> $today
	fi
	printf "### Morning\n\n\n### Afternoon\n\n\n### Evening\n" >> $today
    fi
    $EDITOR "$today"
}

if [[ ! $1 ]]; then
    newDay
else
    case "$1" in
	"notes") $EDITOR notes;;
	"last")
	    # Display latest entry, not including today's
	    cat $(ls -1tr *.md | tail -n 2 | grep -v $today) ;;
	"rand")
	    # Display a random entry
	    cat $(ls -1 | shuf | head -n 1) ;;
	"stats")
	    # Basic stats, should expand this (days done (since date?), etc.)
	    # This should be find but whatever
	    count=$(ls -1 | grep -E "\d{4}-\d{2}-\d{2}\.md" | wc -l | tr -d ' ')
	    echo "There are $count entries!"
    esac
fi
